Report for Lab2
计34 茹逸中 2013011375

**练习1：**

实现过程：

default_init_memmap函数：
在初始化时，需要将base插入到合适的位置，因此需要先遍历链表来找到第一个比base地址值大的块p，然后将base插入到p的前面。

default_alloc_pages函数：
依次遍历链表，找到第一块大小大于等于需要分配大小的块，分配内存。原来的代码已经实现了这个功能，不需要更改。

default_free_pages函数：
同样需要将base插入到合适的位置，先遍历链表找到第一个比base地址值大的块p，然后将base插入到p的前面。判断base前面的块和后面的块与p是否连续，若连续，则合并两块。

你的first fit算法是否有进一步的改进空间？
当前实现的first fit算法效率非常低，每次在free时都需要逐个遍历链表中的内存块来找到合适的插入位置。可以实现一个树结构（例如红黑树）来维护，提高效率。

**练习2：**

实现过程：

找到la对应的页目录项。若该页目录项对应的页表存在，则直接返回该页表的内核态物理地址，否则要新建一个页表，然后返回该新建页表的内核态物理地址。

在新建页表时，要先分配一个页的空间，然后设置页属性，最后设置页目录项的值。

(1) 请描述页目录项（Pag Director Entry）和页表（Page Table Entry）中每个组成部分的含义和以及对ucore而言的潜在用处。

页目录项和页表项的高22位用来表示该页表或该页的起始地址。

最低位为present位，表示这一页是否在内存中，若present为0则表明这一页还没有被分配或者当前在外存中，present可以用来辅助虚拟内存管理。

第二位为writeable,表示这一页是否可写，若writeable为0则表明该页只读。这一位是出于安全性的考虑，用来保护一些重要数据。

第三位是user位，表示这一页是否为用户可见，若user=0则表示用户不能读写该页。这是为了将用户软件和操作系统隔离开，防止恶意软件修改系统或者软件产生的错误导致系统崩溃。

(2) 如果ucore执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？

这时硬件会保存现场（各个寄存器的值），然后将指令寄存器pc跳转至中断处理程序。

**练习3：**
实现过程：

先判断页表是否存在，若不存在则直接跳出。

然后找到对应的页，将该页的ref值减一。若ref值减到0，则调用free函数。

最后清空页表项。

数据结构Page的全局变量(其实是一个数组)的每一项与页表中的页目录项和页表项有无对应关系?如果有,其对应关 系是啥?

有对应关系。Page的全局变量的每一项的虚拟地址的高10位为页目录表的index, 通过该index和页目录表基地址可得到其中的页目录项。页目录项的前22位为页表基地址，虚拟地址中间的10位为页表的index, 两者相加即可得到物理页地址的高位，与虚拟地址的低12位（页内偏移）连接起来即为实际的物理页的内存地址。

如果希望虚拟地址与物理地址相等，则需要如何修改lab2，完成此事？

在页目录和各页表中均做相等映射，即可使得虚拟地址和物理地址相等。

